<div class="row">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1>Team Analysis<%= " - #{@team}" if @team %></h1>
      
      <%= form_with url: analytics_teams_path, method: :get, local: true, class: "d-flex align-items-center" do |f| %>
        <%= f.select :team, options_for_select([
          ['Arizona Cardinals', 'ARI'], ['Atlanta Falcons', 'ATL'], ['Baltimore Ravens', 'BAL'],
          ['Buffalo Bills', 'BUF'], ['Carolina Panthers', 'CAR'], ['Chicago Bears', 'CHI'],
          ['Cincinnati Bengals', 'CIN'], ['Cleveland Browns', 'CLE'], ['Dallas Cowboys', 'DAL'],
          ['Denver Broncos', 'DEN'], ['Detroit Lions', 'DET'], ['Green Bay Packers', 'GB'],
          ['Houston Texans', 'HOU'], ['Indianapolis Colts', 'IND'], ['Jacksonville Jaguars', 'JAX'],
          ['Kansas City Chiefs', 'KC'], ['Las Vegas Raiders', 'LV'], ['Los Angeles Chargers', 'LAC'],
          ['Los Angeles Rams', 'LAR'], ['Miami Dolphins', 'MIA'], ['Minnesota Vikings', 'MIN'],
          ['New England Patriots', 'NE'], ['New Orleans Saints', 'NO'], ['New York Giants', 'NYG'],
          ['New York Jets', 'NYJ'], ['Philadelphia Eagles', 'PHI'], ['Pittsburgh Steelers', 'PIT'],
          ['San Francisco 49ers', 'SF'], ['Seattle Seahawks', 'SEA'], ['Tampa Bay Buccaneers', 'TB'],
          ['Tennessee Titans', 'TEN'], ['Washington Commanders', 'WAS']
        ], @team), { prompt: "Select Team" }, { class: "form-select me-2" } %>

        <%= f.select :season, options_for_select(season_options, @season),
            {}, { class: "form-select me-2" } %>

        <%= f.submit "Analyze Team", class: "btn btn-primary" %>
      <% end %>
    </div>
  </div>
</div>

<% if @team && @team_players %>
  <div class="row">
    <% %w[QB RB WR TE].each do |position| %>
      <div class="col-md-6 col-lg-3 mb-4">
        <div class="card">
          <div class="card-header">
            <h5><%= position %>s</h5>
          </div>
          <div class="card-body">
            <% if @team_players[position].any? %>
              <% @team_players[position].each do |stats| %>
                <div class="mb-3">
                  <%= link_to stats.player.name,
                      analytics_path(stats.player, season: @season),
                      class: "text-decoration-none fw-bold" %>

                  <div class="small text-muted">
                    <% case position %>
                    <% when 'QB' %>
                      <%= stats.pass_yds %> yds, <%= stats.pass_td %> TDs
                      <br><%= stats.calculate_fantasy_points.round(1) %> fantasy pts
                    <% when 'RB' %>
                      <%= stats.rush_yds %> rush yds, <%= stats.rec_yds %> rec yds
                      <br><%= stats.total_td %> TDs, <%= stats.calculate_fantasy_points.round(1) %> pts
                    <% when 'WR', 'TE' %>
                      <%= stats.targets %> targets, <%= stats.rec_yds %> yds
                      <br><%= stats.rec_td %> TDs, <%= stats.calculate_fantasy_points.round(1) %> pts
                    <% end %>
                  </div>
                </div>
              <% end %>
            <% else %>
              <p class="text-muted">No <%= position %> data available</p>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="row">
    <div class="col-12">
      <div class="alert alert-info">
        <h5>Team Analysis</h5>
        <p>Select a team above to view detailed player statistics and fantasy analysis for that organization.</p>
        <p class="mb-0">This analysis will show you:</p>
        <ul class="mb-0">
          <li>All fantasy-relevant players by position</li>
          <li>Individual player performance metrics</li>
          <li>Team total statistics and trends</li>
          <li>Depth chart and target distribution</li>
        </ul>
      </div>
    </div>
  </div>
<% end %>
